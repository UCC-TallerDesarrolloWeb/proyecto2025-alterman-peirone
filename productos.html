<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle del producto</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="FAVICON/favicon-32x32.png" type="image/png" />
</head>
<body>
  <!-- Header -->
  <header>
    <a class="logo" href="index.html">CrewLab</a>
    <div class="acciones">
      <div class="carrito">ðŸ›’</div>
      <div class="menu-hamburguesa" id="menu-btn">â˜°</div>
      <nav class="menu-desplegable" id="menu">
        <ul>
          <li><a href="remeras.html">Remeras</a></li>
          <li><a href="buzos.html">Buzos</a></li>
          <li><a href="pantalones.html">Pantalones</a></li>
          <li><a href="zapatillas.html">Zapatillas</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Contenido del producto -->
  <main>
    <div class="producto-detalle">
      <div class="imagenes">
        <img id="producto-img" src="" alt="Producto">
      </div>
      <div class="info">
        <h1 id="producto-nombre"></h1>
        <p id="producto-precio"></p>

        <label for="talle">Seleccionar talle:</label>
        <select id="talle"></select>

        <label for="cantidad">Cantidad:</label>
        <input type="number" id="cantidad" min="1" value="1">

        <button id="btn-agregar">Agregar al carrito</button>
      </div>
    </div>
  </main>

  <script>
    // --- Lista de productos (recortada como ejemplo) ---
    const productos = [
      { id: 1, nombre: "Remera Azul Design", precio: 30000, img: "REMERAS/Remera Azul Design.jpg", talles: ["XS","S","M","L","XL","2XL","3XL"] },
      { id: 12, nombre: "Buzo negro desgastado", precio: 100000, img: "BUZOS/buzo negro desgastado.jpg", talles: ["XS","S","M","L","XL","2XL","3XL"] },
      { id: 15, nombre: "Cargo color negro (con puÃ±o)", precio: 110000, img: "PANTALONES/Cargo color Negro (con puÃ±o).jpg", talles: ["XS","S","M","L","XL","2XL","3XL"] },
      { id: 26, nombre: "Vans Knu blanco-negro", precio: 200000, img: "ZAPATILLAS/Vans Knu blanco-negro.jpg", talles: ["38","39","40","41","42","43","44"] }
    ];

    // --- Leer parÃ¡metro ID de la URL ---
    const params = new URLSearchParams(window.location.search);
    const id = parseInt(params.get("id"));

    // --- Buscar producto ---
    const producto = productos.find(p => p.id === id);

    if (producto) {
      document.getElementById("producto-img").src = producto.img;
      document.getElementById("producto-nombre").textContent = producto.nombre;
      document.getElementById("producto-precio").textContent = "$" + producto.precio.toLocaleString("es-AR");

      const talleSelect = document.getElementById("talle");
      talleSelect.innerHTML = "";
      (producto.talles || []).forEach(t => {
        const option = document.createElement("option");
        option.value = t;
        option.textContent = t;
        talleSelect.appendChild(option);
      });
    } else {
      document.querySelector("main").innerHTML = "<h2>Producto no encontrado</h2>";
    }

    // --- Carrito persistente ---
    const STORAGE_KEY = "crewlab_carrito";
    let carrito = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    function saveCart() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(carrito));
      updateCartBadge();
    }

    // Modal carrito
    let carritoModal = document.getElementById("carrito-modal");
    if (!carritoModal) {
      carritoModal = document.createElement("div");
      carritoModal.id = "carrito-modal";
      carritoModal.className = "carrito-modal oculto";
      carritoModal.innerHTML = `
        <h2>Tu carrito ðŸ›’</h2>
        <ul id="carrito-lista"></ul>
        <p id="carrito-total">Total: $0</p>
        <button id="finalizar-compra">Finalizar compra</button>
        <button id="cerrar-carrito">Cerrar</button>
      `;
      document.body.appendChild(carritoModal);
    }

    const carritoLista = document.getElementById("carrito-lista");
    const carritoTotal = document.getElementById("carrito-total");
    const cerrarCarritoBtn = document.getElementById("cerrar-carrito");
    const finalizarCompraBtn = document.getElementById("finalizar-compra");

    const carritoIcon = document.querySelector(".carrito");
    if (carritoIcon) {
      carritoIcon.style.cursor = "pointer";
      carritoIcon.addEventListener("click", () => {
        carritoModal.classList.toggle("oculto");
        renderCart();
      });
    }

    if (cerrarCarritoBtn) {
      cerrarCarritoBtn.addEventListener("click", () => {
        carritoModal.classList.add("oculto");
      });
    }

    if (finalizarCompraBtn) {
      finalizarCompraBtn.addEventListener("click", () => {
        window.location.href = "checkout.html";
      });
    }

    function addToCart(product) {
      const existente = carrito.find(i => i.nombre === product.nombre);
      if (existente) existente.cantidad += product.cantidad;
      else carrito.push({ ...product });
    }

    function renderCart() {
      if (!carritoLista) return;
      carritoLista.innerHTML = "";
      let total = 0;

      carrito.forEach((item, index) => {
        total += item.precio * item.cantidad;
        const li = document.createElement("li");
        li.className = "carrito-item";
        li.innerHTML = `
          <div class="item-info">
            <strong>${item.nombre}</strong>
            <div>$${item.precio}</div>
          </div>
          <div class="item-ctrls">
            <button class="cantidad-menos" data-index="${index}">-</button>
            <span>${item.cantidad}</span>
            <button class="cantidad-mas" data-index="${index}">+</button>
            <button class="eliminar" data-index="${index}">Eliminar</button>
          </div>
        `;
        carritoLista.appendChild(li);
      });

      carritoTotal.textContent = "Total: $" + total;
      updateCartBadge();
    }

    function updateCartBadge() {
      const count = carrito.reduce((s, i) => s + i.cantidad, 0);
      if (!carritoIcon) return;
      let badge = carritoIcon.querySelector(".carrito-badge");
      if (!badge) {
        badge = document.createElement("span");
        badge.className = "carrito-badge";
        carritoIcon.appendChild(badge);
      }
      badge.textContent = count > 0 ? count : "";
    }

    // Eventos dentro del carrito modal
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("eliminar")) {
        const idx = Number(e.target.dataset.index);
        carrito.splice(idx, 1);
        saveCart();
        renderCart();
      }
      if (e.target.classList.contains("cantidad-mas")) {
        const idx = Number(e.target.dataset.index);
        carrito[idx].cantidad++;
        saveCart();
        renderCart();
      }
      if (e.target.classList.contains("cantidad-menos")) {
        const idx = Number(e.target.dataset.index);
        carrito[idx].cantidad = Math.max(1, carrito[idx].cantidad - 1);
        saveCart();
        renderCart();
      }
    });

    // BotÃ³n agregar producto desde detalle
    const btnAgregar = document.getElementById("btn-agregar");
    if (btnAgregar && producto) {
      btnAgregar.addEventListener("click", () => {
        const talle = document.getElementById("talle").value;
        const cantidad = parseInt(document.getElementById("cantidad").value);

        const productoSeleccionado = {
          nombre: producto.nombre + " (Talle: " + talle + ")",
          precio: producto.precio,
          cantidad: cantidad
        };

        addToCart(productoSeleccionado);
        saveCart();
        renderCart();
        alert("Producto agregado al carrito âœ…");
      });
    }

    // MenÃº desplegable
    const menuBtn = document.getElementById("menu-btn");
    const menu = document.getElementById("menu");
    if (menuBtn && menu) {
      menuBtn.addEventListener("click", () => {
        menu.classList.toggle("activo");
      });

      document.addEventListener("click", (e) => {
        if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
          menu.classList.remove("activo");
        }
      });
    }

    renderCart();
  </script>
</body>
</html>
